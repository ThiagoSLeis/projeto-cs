{% extends 'menu/cliente/template_cliente.html' %}
{% load static %}

{% block title %}{{ artigo.titulo }} - Base de Conhecimento{% endblock %}

{% block page_header %}
<div class="breadcrumb-nav">
    <a href="{% url 'base_conhecimento' %}"><i class="fas fa-book"></i> Central de Ajuda</a>
    <i class="fas fa-chevron-right"></i>
    <a href="{% url 'categoria_artigos' artigo.categoria.slug %}">{{ artigo.categoria.nome }}</a>
    <i class="fas fa-chevron-right"></i>
    <span>{{ artigo.titulo }}</span>
</div>
{% endblock %}

{% block extra_css %}
<link href="{% static 'menu/css/base_conhecimento.css' %}" rel="stylesheet">
<link href="{% static 'menu/css/artigo_detalhe.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}

<div class="article-container">
    <!-- Conteúdo Principal do Artigo -->
    <div class="article-main">
        
        <!-- Cabeçalho do Artigo -->
        <div class="article-header">
            <span class="article-badge-large article-badge-{{ artigo.tipo }}">
                {{ artigo.tipo|upper }}
            </span>
            
            <h1 class="article-title">{{ artigo.titulo }}</h1>
            
            <div class="article-meta-info">
                <div class="meta-item">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Publicado em <strong>{{ artigo.data_publicacao|date:"d/m/Y" }}</strong></span>
                </div>
                
                <div class="meta-item">
                    <i class="fas fa-user-edit"></i>
                    <span>Por <strong>{{ artigo.autor }}</strong></span>
                </div>
                
                <div class="meta-item">
                    <i class="fas fa-clock"></i>
                    <span><strong>{{ artigo.tempo_leitura }} min</strong> de leitura</span>
                </div>
                
                <div class="meta-item">
                    <i class="fas fa-eye"></i>
                    <span><strong>{{ artigo.visualizacoes }}</strong> visualizações</span>
                </div>
                
                <div class="meta-item">
                    <i class="fas fa-star"></i>
                    <span>Avaliação <strong>{{ artigo.avaliacao }}/5.0</strong></span>
                </div>
            </div>
        </div>

        <!-- Conteúdo do Artigo -->
        <div class="article-content">
            {{ artigo.conteudo|safe }}
        </div>

        <!-- Avaliação do Artigo -->
        <div class="article-rating-section">
            <h3>Este artigo foi útil?</h3>
            <p style="color: var(--text-muted);">Sua avaliação nos ajuda a melhorar nosso conteúdo</p>
            
            <div class="rating-buttons">
                <button class="rating-btn rating-btn-yes" onclick="rateArticle('{{ artigo.slug }}', true)">
                    <i class="fas fa-thumbs-up"></i> Sim, ajudou!
                </button>
                <button class="rating-btn rating-btn-no" onclick="rateArticle('{{ artigo.slug }}', false)">
                    <i class="fas fa-thumbs-down"></i> Não ajudou
                </button>
            </div>

            <div class="rating-thank-you" id="ratingThankYou">
                <i class="fas fa-check-circle" style="font-size: 2rem; color: var(--success-color);"></i>
                <p style="margin-top: 10px; font-weight: 600;">Obrigado pelo seu feedback!</p>
            </div>
        </div>

        <!-- Navegação entre Artigos -->
        <div class="navigation-buttons">
            {% if artigo_anterior %}
            <a href="{% url 'artigo_detalhe' artigo_anterior.slug %}" class="nav-btn">
                <div class="nav-btn-icon">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="nav-btn-info">
                    <div class="nav-btn-label">Artigo Anterior</div>
                    <div class="nav-btn-title">{{ artigo_anterior.titulo }}</div>
                </div>
            </a>
            {% else %}
            <div></div>
            {% endif %}

            {% if artigo_proximo %}
            <a href="{% url 'artigo_detalhe' artigo_proximo.slug %}" class="nav-btn" style="text-align: right;">
                <div class="nav-btn-info">
                    <div class="nav-btn-label">Próximo Artigo</div>
                    <div class="nav-btn-title">{{ artigo_proximo.titulo }}</div>
                </div>
                <div class="nav-btn-icon">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </a>
            {% endif %}
        </div>

    </div>

    <!-- Sidebar -->
    <div class="article-sidebar">
        
        <!-- Índice do Artigo -->
        <div class="sidebar-card">
            <h4><i class="fas fa-list-ul"></i> Neste Artigo</h4>
            <ul class="toc-list" id="tocList">
                <!-- Será preenchido dinamicamente pelo JavaScript -->
            </ul>
        </div>

        <!-- Artigos Relacionados -->
        {% if artigos_relacionados %}
        <div class="sidebar-card">
            <h4><i class="fas fa-link"></i> Artigos Relacionados</h4>
            
            {% for relacionado in artigos_relacionados %}
            <a href="{% url 'artigo_detalhe' relacionado.slug %}" class="related-article">
                <div class="related-article-icon">
                    <i class="{{ relacionado.icone|default:'fas fa-file-alt' }}"></i>
                </div>
                <div class="related-article-info">
                    <h5>{{ relacionado.titulo }}</h5>
                    <p>{{ relacionado.tempo_leitura }} min de leitura</p>
                </div>
            </a>
            {% endfor %}
        </div>
        {% endif %}

        <!-- CTA para Suporte -->
        <div class="sidebar-card sidebar-card-cta">
            <i class="fas fa-headset" style="font-size: 3rem; margin-bottom: 15px;"></i>
            <h4 style="color: white;">Precisa de ajuda?</h4>
            <p style="font-size: 0.95rem; margin-bottom: 20px;">Nossa equipe está pronta para atendê-lo</p>
            <button class="btn-cta btn-cta-white" onclick="openTicket()">
                <i class="fas fa-comment-alt"></i> Abrir Chamado
            </button>
        </div>

    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'menu/js/base_conhecimento.js' %}"></script>
<script src="{% static 'menu/js/artigo_detalhe.js' %}"></script>
<script>
    // Passar dados do Django para o JavaScript
    const ARTIGO_SLUG = '{{ artigo.slug }}';
</script>
{% endblock %}