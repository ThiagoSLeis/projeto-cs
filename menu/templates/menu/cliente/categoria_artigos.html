{% extends 'menu/cliente/template_cliente.html' %}
{% load static %}

{% block title %}{{ categoria.nome }} - Base de Conhecimento{% endblock %}

{% block page_header %}
<div class="breadcrumb-nav">
    <a href="{% url 'base_conhecimento' %}"><i class="fas fa-book"></i> Central de Ajuda</a>
    <i class="fas fa-chevron-right"></i>
    <span>{{ categoria.nome }}</span>
</div>
<h1><i class="{{ categoria.icone }}"></i> {{ categoria.nome }}</h1>
<p>{{ categoria.descricao }} - <span id="currentDate"></span></p>
{% endblock %}

{% block extra_css %}
<link href="{% static 'menu/css/base_conhecimento.css' %}" rel="stylesheet">
<link href="{% static 'menu/css/categoria_artigos.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}

<!-- Banner da Categoria -->
<div class="category-header-banner">
    <div class="category-header-icon">
        <i class="{{ categoria.icone }}"></i>
    </div>
    <div class="category-header-info">
        <h2>{{ categoria.nome }}</h2>
        <p>{{ categoria.descricao }}</p>
    </div>
</div>

<!-- Barra de Filtros e Ordenação -->
<div class="filter-sort-bar">
    <div class="filter-group">
        <label for="filterType">Filtrar por:</label>
        <select id="filterType" class="filter-select">
            <option value="todos">Todos os tipos</option>
            <option value="tutorial">Tutorial</option>
            <option value="guia">Guia</option>
            <option value="faq">FAQ</option>
        </select>
    </div>

    <div class="filter-group">
        <label for="sortBy">Ordenar por:</label>
        <select id="sortBy" class="filter-select">
            <option value="relevancia">Mais relevantes</option>
            <option value="recentes">Mais recentes</option>
            <option value="visualizacoes">Mais visualizados</option>
            <option value="avaliacao">Melhor avaliados</option>
        </select>
    </div>

    <div class="articles-count">
        <strong>{{ artigos|length }}</strong> artigos encontrados
    </div>
</div>

<!-- Grade de Artigos -->
<div class="articles-grid" id="articlesGrid">
    {% if artigos %}
        {% for artigo in artigos %}
        <div class="article-card-full" data-article="{{ artigo.slug }}" data-type="{{ artigo.tipo }}" onclick="window.location.href='{% url 'artigo_detalhe' artigo.slug %}'">
            <div class="article-card-header">
                <div class="article-badge article-badge-{{ artigo.tipo }}">{{ artigo.tipo|upper }}</div>
                <div class="article-meta">
                    <span class="article-meta-item">
                        <i class="fas fa-calendar"></i>
                        {{ artigo.data_publicacao|date:"d/m/Y" }}
                    </span>
                    <span class="article-meta-item">
                        <i class="fas fa-user"></i>
                        {{ artigo.autor }}
                    </span>
                </div>
            </div>

            <div class="article-card-body">
                <h4>{{ artigo.titulo }}</h4>
                
                <p class="article-description">{{ artigo.resumo }}</p>

                {% if artigo.tags %}
                <div class="article-tags">
                    {% for tag in artigo.tags %}
                    <span class="article-tag">{{ tag }}</span>
                    {% endfor %}
                </div>
                {% endif %}

                <div class="article-card-footer">
                    <div class="article-stats">
                        <span class="article-meta-item">
                            <i class="fas fa-eye"></i>
                            {{ artigo.visualizacoes }}
                        </span>
                        <span class="article-meta-item">
                            <i class="fas fa-star"></i>
                            {{ artigo.avaliacao }}
                        </span>
                    </div>
                    <div class="read-time">
                        <i class="fas fa-clock"></i>
                        {{ artigo.tempo_leitura }} min
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="fas fa-search"></i>
            </div>
            <h3>Nenhum artigo encontrado</h3>
            <p>Não há artigos disponíveis nesta categoria no momento.</p>
            <a href="{% url 'base_conhecimento' %}" class="btn-cta">
                <i class="fas fa-arrow-left"></i> Voltar à Central de Ajuda
            </a>
        </div>
    {% endif %}
</div>

<!-- Paginação -->
{% if artigos %}
<div class="pagination">
    <button class="pagination-btn" id="prevPage" onclick="changePage(-1)">
        <i class="fas fa-chevron-left"></i> Anterior
    </button>
    
    <button class="pagination-btn active">1</button>
    <button class="pagination-btn">2</button>
    <button class="pagination-btn">3</button>
    
    <button class="pagination-btn" id="nextPage" onclick="changePage(1)">
        Próxima <i class="fas fa-chevron-right"></i>
    </button>
</div>
{% endif %}

<!-- Categorias Relacionadas -->
<div class="related-categories" style="margin-top: 60px;">
    <h3 class="section-title">
        <i class="fas fa-layer-group"></i> Outras Categorias
    </h3>
    
    <div class="row g-4">
        {% for cat in outras_categorias %}
        <div class="col-md-6 col-lg-4">
            <div class="category-card" data-category="{{ cat.slug }}" onclick="window.location.href='{% url 'categoria_artigos' cat.slug %}'">
                <div class="category-icon" style="background: {{ cat.cor_gradiente }};">
                    <i class="{{ cat.icone }}"></i>
                </div>
                <h4>{{ cat.nome }}</h4>
                <p>{{ cat.descricao }}</p>
                <div class="category-count">{{ cat.total_artigos }} artigos</div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'menu/js/base_conhecimento.js' %}"></script>
<script src="{% static 'menu/js/categoria_artigos.js' %}"></script>
{% endblock %}